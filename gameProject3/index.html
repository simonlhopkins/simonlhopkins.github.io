<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="stylesheet.css">
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mousetrap/1.6.1/mousetrap.js"></script>
	</head>
	<body>
		<style>
			#playerSelectionContainer{
				display: block;
				margin: 10px;
			}
			.playerSquare{
				display: block;
				border-style: solid;
				border-radius: 5px;
				margin: 10px;
				min-width: 100px;
				float: left;
			}
			.playerSquare p{
				
				text-align: center;
			}
			#enterPrompt{
				display: block;
				font-size: 24px;
			}
		</style>
		<script type="text/javascript">
			localStorage.clear();
			localStorage.setItem("roomOptions", "Bathroom,q|Bedroom,w|Kitchen,e|Study,r|Ballroom,t|Gun Room,y|Wine Cellar,u|Dining Room,i")
			function parseRooms(){
				var tempRooms= localStorage["roomOptions"].split("|");
				for(var i=0; i< tempRooms.length;i++){
					tempRooms[i]= tempRooms[i].split(",");
				}
				return tempRooms
			}
			function parseGameJSON(){
				return JSON.parse(localStorage["game"]);
			}
			
			var rooms= parseRooms();
			console.log(rooms);
			var randomNames=[];
			var everyOneReady=false;
			$.ajax({
				async: false,
    			url: "https://raw.githubusercontent.com/dominictarr/random-name/master/first-names.json",
    			dataType:"JSON",
    			success:function(data){
    				randomNames=data
    			}

			})
			
			
			
			var game={
				"players": [],
			}

			localStorage.setItem("game", JSON.stringify(game));
			console.log(parseGameJSON());
			function createPlayer(keys, turnOrder){
				$("#playerSelectionContainer").empty();
				var newPlayer= new Object();
				newPlayer["name"] = randomNames[parseInt(Math.random()*randomNames.length)];
				newPlayer["hp"]=10;
				newPlayer["keys"]=[keys]
				newPlayer["turnOrder"]=turnOrder;
				newPlayer["id"]=parseInt(Math.random()*1000000);
				newPlayer["currentRoom"]=rooms[Math.floor(Math.random()*rooms.length)];
				var game= parseGameJSON();
				if(!checkForDuplicate(newPlayer)){
					game.players.push(newPlayer);
				}

				
				if(game.players.length==4){
					$("body").append("<p id='enterPrompt'>Press enter to start!!</p>")
					var randomNum= Math.floor(Math.random() * 3).toString();
					everyOneReady=true;
				}
				
				for(var i=0; i<game.players.length; i++){
					addPlayerToPage(game.players[i]["name"], game.players[i]["currentRoom"][0]);
				}
				localStorage["game"]=JSON.stringify(game);
				
			}
			
			function checkForDuplicate(newPlayer){
				var game= parseGameJSON();
				for(var i=0; i<game.players.length; i++){
					if(game.players[i]["keys"].toString()==newPlayer["keys"].toString()){
						return true;
					}
				}
				return false;
			}
			function addPlayerToPage(name, startingRoom){
				
				var newPlayerSquare=$("<div class='playerSquare'><p>"+name+"</p></div>").appendTo("#playerSelectionContainer");
				newPlayerSquare.append("<p>"+startingRoom+"</p>");
			}
			
			Mousetrap.bind("z", function(){
				createPlayer(["z", "x"], 0);
			});
			Mousetrap.bind("c", function(){
				createPlayer(["c", "v"], 1);
			});
			Mousetrap.bind("b", function(){
				createPlayer(["b", "n"], 2);
			});
			Mousetrap.bind("m", function(){
				createPlayer(["m",","], 3);
			});
			Mousetrap.bind("enter", function(){
				if(everyOneReady){
					open("homePage.html");
				}
			});
			
		</script>

		<p>Press the Square Key to Join!!</p>
		<div id="playerSelectionContainer">
			
		</div>
		
	</body>
</html>