<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="stylesheet.css">
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mousetrap/1.6.1/mousetrap.js"></script>
	</head>
	<body>
		<ul>
			<li>Roll a dice</li>
			<li>Move to a room</li>
			<li>Press the button in the room that you are in</li>
			<li>Survive the night o.O</li>
		</ul>
		<script type="text/javascript">
			var gameJSON= JSON.parse(localStorage["game"]);
			var coopMinigames=[];
			var pvpMiniGames=["miniGame1.html"];
			var turnNumber=0;

			function parseGameJSON(){
				return JSON.parse(localStorage["game"]);
			}
			function parseRooms(){
				var tempRooms= localStorage["roomOptions"].split("|");
				for(var i=0; i< tempRooms.length;i++){
					tempRooms[i]= tempRooms[i].split(",");
				}
				return tempRooms
			}
			function setLocations(keyPressed){

				var gameJSON=parseGameJSON();
				var roomList=parseRooms();
				var roomDict={}
				var currentRoom;
				var playersInRoom=[];
				var currentPlayer= gameJSON.players[turnNumber];
				var killerLocation=roomList[Math.floor(Math.random()*roomList.length)]
				//loop through rooms and set the current room to whatever button you press
				for(var i=0; i<roomList.length; i++){
					roomDict[roomList[i][0]]=[];
					if(keyPressed.toString()==roomList[i][1]){
						currentRoom=roomList[i];
					}
				}
				//room tracking

				gameJSON.players[turnNumber]["currentRoom"]=currentRoom;
				for(var i=0; i<gameJSON.players.length;i++){
					roomDict[gameJSON.players[i]["currentRoom"][0]].push(gameJSON.players[i]["name"]);
				}
				roomDict[killerLocation[0]].push("KILLER");
				console.log(killerLocation);
				playersInRoom= roomDict[currentRoom[0]];
				localStorage.setItem("playersAboutToCompete", playersInRoom.toString());
				console.log(localStorage["playersAboutToCompete"]);
				//need to launch a mini game here
				if(currentRoom[0]==killerLocation[0]){
					console.log("Launching... players vs killers")
				}
				else if(playersInRoom.length>1){
					console.log("Launching... players vs players")
				}
				else{
					console.log("Launching... players vs enemy easy")
				}
				if(turnNumber==3){
					turnNumber=0;
				}else{
					turnNumber+=1;
				}
				localStorage["game"]=JSON.stringify(gameJSON);
				open("miniGame2.html");

			}

			function launchMiniGame(players){
				
			}
			Mousetrap.bind("q", function(){
				setLocations("q");
			});
			Mousetrap.bind("w", function(){
				setLocations("w");
			});
			Mousetrap.bind("e", function(){
				setLocations("e");
			});
			Mousetrap.bind("r", function(){
				setLocations("r");
			});
			Mousetrap.bind("t", function(){
				setLocations("t");
			});
			Mousetrap.bind("y", function(){
				setLocations("y");
			});
			Mousetrap.bind("u", function(){
				setLocations("u");
			});
			Mousetrap.bind("i", function(){
				setLocations("i");
			});
		</script>
		<p id="turnIndicator"></p>
		
	</body>
</html>